(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1166:function(e,r,n){Promise.resolve().then(n.bind(n,2206))},2206:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return u}});var i=n(7437),t=n(2265);async function d(){try{let e=await fetch("/bff/user",{credentials:"include",headers:{"X-CSRF":"1"}});if(e.ok){let r=await e.json();if(Array.isArray(r)&&r.length>0)return{isAuthenticated:!0,user:r,isLoading:!1}}return{isAuthenticated:!1,user:null,isLoading:!1}}catch(e){return console.error("Authentication check failed:",e),{isAuthenticated:!1,user:null,isLoading:!1}}}function o(e,r){let n=e.find(e=>e.type===r);return n?n.value:null}function s(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],[r,n]=(0,t.useState)({isAuthenticated:!1,user:null,isLoading:!0});return(0,t.useEffect)(()=>{(async()=>{let r=await d();n(r),!e||r.isAuthenticated||r.isLoading||function(){let e=window.location.pathname+window.location.search;window.location.href="/bff/login?returnUrl=".concat(encodeURIComponent(e))}()})()},[e]),r}function l(e){let{children:r,loadingComponent:n}=e,{isAuthenticated:t,isLoading:d}=s(!0);return d?(0,i.jsx)(i.Fragment,{children:n||(0,i.jsxs)("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",textAlign:"center",marginTop:"4rem"},children:[(0,i.jsx)("div",{style:{display:"inline-block",width:"50px",height:"50px",border:"5px solid #f3f3f3",borderTop:"5px solid #0070f3",borderRadius:"50%",animation:"spin 1s linear infinite"}}),(0,i.jsx)("p",{style:{marginTop:"1rem",color:"#666"},children:"Loading..."}),(0,i.jsx)("style",{children:"\n              @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n              }\n            "})]})}):t?(0,i.jsx)(i.Fragment,{children:r}):null}function a(e){let{claims:r}=e,n=o(r,"name")||o(r,"preferred_username")||o(r,"email")||"User";return(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",marginBottom:"2rem"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{style:{fontSize:"0.9rem",color:"#6c757d"},children:"Logged in as:"}),(0,i.jsx)("strong",{style:{marginLeft:"0.5rem",fontSize:"1.1rem"},children:n})]}),(0,i.jsx)("button",{onClick:()=>(function(e){let r=o(e,"id_token"),n=o(e,"sid"),i="/bff/logout",t=new URLSearchParams;r&&t.append("id_token_hint",r),n&&t.append("sid",n),t.toString()&&(i+="?".concat(t.toString())),window.location.href=i})(r),style:{padding:"0.5rem 1rem",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"0.95rem",fontWeight:"500"},children:"Logout"})]})}function c(){let{user:e}=s(!1),[r,n]=(0,t.useState)(null),[d,o]=(0,t.useState)(!1),[l,c]=(0,t.useState)(null),u=async()=>{c(null),o(!0);try{let e=await fetch("/api/products",{credentials:"include",headers:{"X-CSRF":"1"}});if(e.ok){let r=await e.json();n(r)}else c("Failed to fetch products")}catch(e){console.error("Fetch error:",e),c("Failed to fetch products")}finally{o(!1)}};return e?(0,i.jsxs)("div",{style:{padding:"2rem",maxWidth:"1100px",margin:"0 auto",fontFamily:"system-ui, sans-serif"},children:[(0,i.jsx)("h1",{style:{marginBottom:"1.5rem"},children:"Products Microservice"}),(0,i.jsxs)("p",{style:{color:"#666",marginBottom:"2rem"},children:["This UI is powered by the ",(0,i.jsx)("strong",{children:"Products BFF"}),". It retrieves product data via the BFF-protected endpoint ",(0,i.jsx)("code",{children:"/api/products"}),"."]}),(0,i.jsx)(a,{claims:e}),l&&(0,i.jsxs)("div",{style:{backgroundColor:"#fee",padding:"1rem",marginTop:"1rem",borderRadius:"6px",color:"#a00",border:"1px solid #fcc"},children:[(0,i.jsx)("strong",{children:"Error:"})," ",l]}),(0,i.jsx)("div",{style:{marginTop:"2rem"},children:(0,i.jsx)("button",{onClick:u,disabled:d,style:{padding:"0.75rem 1.5rem",backgroundColor:d?"#aaa":"#2563eb",color:"white",border:"none",borderRadius:"6px",cursor:d?"not-allowed":"pointer",fontSize:"1rem",fontWeight:500},children:d?"Loading...":"Load Products"})}),r&&(0,i.jsxs)("div",{style:{marginTop:"2rem",backgroundColor:"#f8f9fa",padding:"1rem",borderRadius:"6px",border:"1px solid #e2e8f0"},children:[(0,i.jsx)("h2",{style:{marginBottom:"1rem"},children:"Products"}),(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.95rem"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{backgroundColor:"#e2e8f0"},children:[(0,i.jsx)("th",{style:{padding:"0.5rem",border:"1px solid #cbd5e1"},children:"ID"}),(0,i.jsx)("th",{style:{padding:"0.5rem",border:"1px solid #cbd5e1"},children:"Name"}),(0,i.jsx)("th",{style:{padding:"0.5rem",border:"1px solid #cbd5e1"},children:"Category"}),(0,i.jsx)("th",{style:{padding:"0.5rem",border:"1px solid #cbd5e1"},children:"Price"}),(0,i.jsx)("th",{style:{padding:"0.5rem",border:"1px solid #cbd5e1"},children:"Stock"})]})}),(0,i.jsx)("tbody",{children:r.products.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"0.5rem",border:"1px solid #e2e8f0"},children:e.id}),(0,i.jsx)("td",{style:{padding:"0.5rem",border:"1px solid #e2e8f0"},children:e.name}),(0,i.jsx)("td",{style:{padding:"0.5rem",border:"1px solid #e2e8f0"},children:e.category}),(0,i.jsxs)("td",{style:{padding:"0.5rem",border:"1px solid #e2e8f0"},children:["$",e.price.toFixed(2)]}),(0,i.jsx)("td",{style:{padding:"0.5rem",border:"1px solid #e2e8f0"},children:e.stock})]},e.id))})]})]}),(0,i.jsxs)("div",{style:{marginTop:"3rem",padding:"1.5rem",backgroundColor:"#eef6ff",borderRadius:"8px",border:"1px solid #bcdfff"},children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"User Claims"}),(0,i.jsx)("ul",{style:{paddingLeft:"1.5rem"},children:e.map((e,r)=>(0,i.jsxs)("li",{style:{marginBottom:"0.4rem"},children:[(0,i.jsxs)("strong",{children:[e.type,":"]})," ",e.value]},r))})]})]}):null}function u(){return(0,i.jsx)(l,{children:(0,i.jsx)(c,{})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=1166)}),_N_E=e.O()}]);