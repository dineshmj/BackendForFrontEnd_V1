(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1575:function(e,r,t){Promise.resolve().then(t.bind(t,2206))},2206:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return u}});var n=t(7437),o=t(2265);async function i(){try{let e=await fetch("/bff/user",{credentials:"include",headers:{"X-CSRF":"1"}});if(e.ok){let r=await e.json();if(Array.isArray(r)&&r.length>0)return{isAuthenticated:!0,user:r,isLoading:!1}}return{isAuthenticated:!1,user:null,isLoading:!1}}catch(e){return console.error("Authentication check failed:",e),{isAuthenticated:!1,user:null,isLoading:!1}}}function s(e,r){let t=e.find(e=>e.type===r);return t?t.value:null}function d(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],[r,t]=(0,o.useState)({isAuthenticated:!1,user:null,isLoading:!0});return(0,o.useEffect)(()=>{(async()=>{let r=await i();t(r),!e||r.isAuthenticated||r.isLoading||function(){let e=window.location.pathname+window.location.search;window.location.href="/bff/login?returnUrl=".concat(encodeURIComponent(e))}()})()},[e]),r}function l(e){let{children:r,loadingComponent:t}=e,{isAuthenticated:o,isLoading:i}=d(!0);return i?(0,n.jsx)(n.Fragment,{children:t||(0,n.jsxs)("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",textAlign:"center",marginTop:"4rem"},children:[(0,n.jsx)("div",{style:{display:"inline-block",width:"50px",height:"50px",border:"5px solid #f3f3f3",borderTop:"5px solid #0070f3",borderRadius:"50%",animation:"spin 1s linear infinite"}}),(0,n.jsx)("p",{style:{marginTop:"1rem",color:"#666"},children:"Loading..."}),(0,n.jsx)("style",{children:"\n              @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n              }\n            "})]})}):o?(0,n.jsx)(n.Fragment,{children:r}):null}function a(e){let{claims:r}=e,t=s(r,"name")||s(r,"preferred_username")||s(r,"email")||"User";return(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",marginBottom:"2rem"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{style:{fontSize:"0.9rem",color:"#6c757d"},children:"Logged in as:"}),(0,n.jsx)("strong",{style:{marginLeft:"0.5rem",fontSize:"1.1rem"},children:t})]}),(0,n.jsx)("button",{onClick:()=>(function(e){let r=s(e,"id_token"),t=s(e,"sid"),n="/bff/logout",o=new URLSearchParams;r&&o.append("id_token_hint",r),t&&o.append("sid",t),o.toString()&&(n+="?".concat(o.toString())),window.location.href=n})(r),style:{padding:"0.5rem 1rem",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"0.95rem",fontWeight:"500"},children:"Logout"})]})}function c(){let{user:e}=d(!1),[r,t]=(0,o.useState)(null),[i,s]=(0,o.useState)(null),[l,c]=(0,o.useState)(null),[u,m]=(0,o.useState)(null),[f,p]=(0,o.useState)(null),h=async()=>{p(null),m("orders");try{let e=await fetch("/api/orders",{credentials:"include",headers:{"X-CSRF":"1"}});if(e.ok){let r=await e.json();t(r)}else p("Failed to fetch orders")}catch(e){console.error("Failed to fetch orders:",e),p("Failed to fetch orders")}finally{m(null)}},g=async()=>{p(null),m("products");try{let e=await fetch("/api/products",{credentials:"include",headers:{"X-CSRF":"1"}});if(e.ok){let r=await e.json();s(r)}else p("Failed to fetch products")}catch(e){console.error("Failed to fetch products:",e),p("Failed to fetch products")}finally{m(null)}},y=async()=>{p(null),m("payments");try{let e=await fetch("/api/payments",{credentials:"include",headers:{"X-CSRF":"1"}});if(e.ok){let r=await e.json();c(r)}else p("Failed to fetch payments")}catch(e){console.error("Failed to fetch payments:",e),p("Failed to fetch payments")}finally{m(null)}};return e?(0,n.jsxs)("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",maxWidth:"1200px",margin:"0 auto"},children:[(0,n.jsx)("h1",{style:{marginBottom:"1.5rem"},children:"BFF Application with NextJS"}),(0,n.jsx)(a,{claims:e}),f&&(0,n.jsxs)("div",{style:{padding:"1rem",marginBottom:"1rem",backgroundColor:"#fee",color:"#c00",borderRadius:"5px",border:"1px solid #fcc"},children:[(0,n.jsx)("strong",{children:"Error:"})," ",f]}),(0,n.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,n.jsx)("h2",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"API Actions"}),(0,n.jsxs)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[(0,n.jsx)("button",{onClick:h,disabled:"orders"===u,style:{padding:"0.75rem 1.5rem",backgroundColor:"orders"===u?"#ccc":"#059669",color:"white",border:"none",borderRadius:"5px",cursor:"orders"===u?"not-allowed":"pointer",fontSize:"0.95rem"},children:"orders"===u?"Loading...":"Fetch Orders"}),(0,n.jsx)("button",{onClick:g,disabled:"products"===u,style:{padding:"0.75rem 1.5rem",backgroundColor:"products"===u?"#ccc":"#7c3aed",color:"white",border:"none",borderRadius:"5px",cursor:"products"===u?"not-allowed":"pointer",fontSize:"0.95rem"},children:"products"===u?"Loading...":"Fetch Products"}),(0,n.jsx)("button",{onClick:()=>{p(null),m("products-ui");let e=document.getElementById("products-frame");if(!e){p("Iframe not found"),m(null);return}e.src="/bff/forward/products",e.onload=()=>{m(null)}},disabled:"products-ui"===u,style:{padding:"0.75rem 1.5rem",backgroundColor:"products-ui"===u?"#ccc":"#2563eb",color:"white",border:"none",borderRadius:"5px",cursor:"products-ui"===u?"not-allowed":"pointer",fontSize:"0.95rem"},children:"products-ui"===u?"Loading UI...":"Show Products Web UI"}),(0,n.jsx)("button",{onClick:y,disabled:"payments"===u,style:{padding:"0.75rem 1.5rem",backgroundColor:"payments"===u?"#ccc":"#ea580c",color:"white",border:"none",borderRadius:"5px",cursor:"payments"===u?"not-allowed":"pointer",fontSize:"0.95rem"},children:"payments"===u?"Loading...":"Fetch Payments"})]})]}),r&&(0,n.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,n.jsx)("h2",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Orders"}),(0,n.jsx)("div",{style:{backgroundColor:"#f8f9fa",padding:"1rem",borderRadius:"5px",border:"1px solid #dee2e6"},children:(0,n.jsx)("pre",{style:{margin:0,overflow:"auto",fontSize:"0.9rem"},children:JSON.stringify(r,null,2)})})]}),i&&(0,n.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,n.jsx)("h2",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Products"}),(0,n.jsx)("div",{style:{backgroundColor:"#f8f9fa",padding:"1rem",borderRadius:"5px",border:"1px solid #dee2e6"},children:(0,n.jsx)("pre",{style:{margin:0,overflow:"auto",fontSize:"0.9rem"},children:JSON.stringify(i,null,2)})})]}),l&&(0,n.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,n.jsx)("h2",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Payments"}),(0,n.jsx)("div",{style:{backgroundColor:"#f8f9fa",padding:"1rem",borderRadius:"5px",border:"1px solid #dee2e6"},children:(0,n.jsx)("pre",{style:{margin:0,overflow:"auto",fontSize:"0.9rem"},children:JSON.stringify(l,null,2)})})]}),(0,n.jsxs)("div",{style:{marginTop:"3rem"},children:[(0,n.jsx)("h2",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Products Micro UI (Embedded)"}),(0,n.jsx)("iframe",{id:"products-frame",style:{width:"100%",height:"600px",border:"1px solid #ccc",borderRadius:"5px"}})]}),(0,n.jsxs)("div",{style:{marginTop:"3rem",padding:"1.5rem",backgroundColor:"#e7f3ff",borderRadius:"8px",border:"1px solid #b3d9ff"},children:[(0,n.jsx)("h3",{style:{marginTop:0,color:"#004085"},children:"User Claims"}),(0,n.jsx)("ul",{style:{margin:0,paddingLeft:"1.5rem"},children:e.map((e,r)=>(0,n.jsxs)("li",{style:{marginBottom:"0.5rem",fontSize:"0.9rem"},children:[(0,n.jsxs)("strong",{children:[e.type,":"]})," ",(0,n.jsx)("span",{style:{color:"#495057"},children:e.value})]},r))})]})]}):null}function u(){return(0,n.jsx)(l,{children:(0,n.jsx)(c,{})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=1575)}),_N_E=e.O()}]);